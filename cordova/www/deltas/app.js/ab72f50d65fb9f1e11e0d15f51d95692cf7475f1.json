["function _ec84b07dc68d4b8de15cf38b13a9f68ca16c117b",50,249,"if(!DietonApp.view.ux){DietonApp.view.ux",295,501718,"day",502128,40,502057,144,",{name:\"currentSugarLevel\",type:\"float\",defaultValue:0},{name:\"currentEnviromentLevel\",type:\"floa",502183,58,"identifier:{type:\"uuid",502238,170,",getKcal:function(){var b=this,e,d,c,a;if(b.get(\"gender\")===\"MALE\"){e=66.5;d=13.75;c=5;a=6.78}else{e=665;d=9.56;c=1.85;a=4.68}return e+(d*b.get(\"weight\"))+(c*b.get(\"height\"))-(a*b.getAge())},getAge:function(){var b=Date.now()-this.get(\"birthday\").getTime();var a=new Date(b);return Math.abs(a.getUTCFullYear()-1970)",502407,404,"id",502820,526,502662,36,503357,434,",sorters:[{property:\"creationDate\",direction:\"DESC\"}]",503791,199,"user",503997,502,"day",504503,65,",currentSugarLevel:",504567,1860,"background-puppet {[this.getEnviromentCls(values)]}\" style=\"height:{[this.getWindowHeight()]};\">','<img style=\"margin-left:{[this.getPuppetMarginLeft(values)]}; margin-top:{[this.getPuppetMarginTop(values)]};\" class=\"{[this.getPuppetCls(values)]}\" src=\"{[this.getPuppetImg(values)]}\" />',\"</div>\",{",492861,34,"Ext.Viewport.windowHeight-45+\"px !important\"",499912,35,"Ext.Viewport.windowWidth},getEnviromentCls:function(a){switch(a.enviromentLevel){case 1:return\"first-state\";break;case 2:return\"second-state\";break;case 3:return\"neutral-state\";break;case 4:return\"fourth-state\";break;case 5:return\"fifth-state\";break;default:return\"\"}},getPuppetImg:function(a){switch(a.puppetLevel){case 1:return\"resources/icons/puppets/Personaje-01.png\";break;case 2:return\"resources/icons/puppets/Personaje-02.png\";break;case 3:return\"resources/icons/puppets/Personaje-03.png\";break;case 4:return\"resources/icons/puppets/Personaje-04.png\";break;case 5:return\"resources/icons/puppets/Personaje-05.png\";break;default:return\"\"}},getPuppetCls:function(a){switch(a.puppetLevel){case 1:return\"puppet-first-state\";break;case 2:return\"puppet-second-state\";break;case 3:return\"puppet-neutral-state\";break;case 4:return\"puppet-fourth-state\";break;case 5:return\"puppet-fifth-state\";break;default:return\"\"}},getPuppetMarginLeft:function(a){switch(a.puppetLevel){case 1:return((Ext.Viewport.windowWidth-500)/2)+\"px !important\";break;case 2:return((Ext.Viewport.windowWidth-450)/2)+\"px !important\";break;case 3:return((Ext.Viewport.windowWidth-400)/2)+\"px !important\";break;case 4:return((Ext.Viewport.windowWidth-350)/2)+\"px !important\";break;case 5:return((Ext.Viewport.windowWidth-300)/2)+\"px !important\";break;default:return\"\"}},getPuppetMarginTop:function(a){switch(a.puppetLevel){case 1:return((Ext.Viewport.windowHeight-800)/2)+\"px !important\";break;case 2:return((Ext.Viewport.windowHeight-750)/2)+\"px !important\";break;case 3:return((Ext.Viewport.windowHeight-700)/2)+\"px !important\";break;case 4:return((Ext.Viewport.windowHeight-650)/2)+\"px !important\";break;case 5:return((Ext.Viewport.windowHeight-600)/2)+\"px !important\";break;default:return\"\"}}})},{xtype:\"container\",layout:\"hbox\",docked:\"bottom\",items:[{xtype:\"button\",itemId:\"searchProduct\",height:60,flex:1,text:\"Buscar Producto\",iconAlign:\"center\",iconCls:\"tickIcon\",icon:\"resources/icons/buttons/BOTONES-45-02.png\",cls:\"button-ivan2\"",506456,42,"height:60,flex:1,text:\"Escanear C\ufffff\ufffffdigo\",iconAlign:\"center\",iconCls:\"tickIcon\",icon:\"resources/icons/buttons/BOTONES-45-01.png\",cls:\"button-ivan2\"}]},{xtype:\"container\",itemId:\"productInfo\",cls:\"product-info\",hidden:true,height:175",506391,41,"<center><div>{product_name}</div></center>\",\"<table>\",\"<thead></thead>\",\"<tbody>\",\"<tr>\",\"<td>Az\ufffff\ufffffcares: </td>\",\"<td>{[this.getSugars(values)]}</td>\",\"</tr>\",\"<tr>\",\"<td>Grasa Saturada: </td>\",\"<td>{[this.getSaturatedFat(values)]}</td>\",\"</tr>\",\"<tr>\",\"<td>Huella Ecol\ufffff\ufffffgica: </td>\",\"<td>{[this.getEcoFootPrint(values)]}</td>\",\"</tr>\",\"</tbody>\",\"</table>\",\"</div>\",{getEcoFootPrint:function(a){if(a.ecoFootprint){return a.ecoFootprint.toFixed(2)+\"g de CO2\"}else{return\"No calculada\"}},getSaturatedFat:function(a){if(a.nutriments[\"saturated-fat\"]){return a.nutriments[\"saturated-fat\"]+\"g\"}return\"\"},getSugars:function(a){if(a.nutriments.sugars){return a.nutriments.sugars+\"g\"}return\"\"}}),items:[{xtype:\"container\",layout:\"hbox\",docked:\"bottom\",cls:\"product-info-buttons\",items:[{xtype:\"button\",itemId:\"reject\",text:\"\",width:82,height:85,docked:\"left\",iconAlign:\"center\",iconCls:\"tickIcon\",icon:\"resources/icons/buttons/BOTONES-45-03.png\",cls:\"button-ivan\"},{xtype:\"button\",itemId:\"approve\",text:\"\",width:82,height:85,docked:\"right\",iconCls:\"tickIcon\",icon:\"resources/icons/buttons/BOTONES-45-04.png\",iconAlign:\"center\",cls:\"button-ivan\"}]}]",506523,244,"lasProductFind:null,",506767,161,",approveButton:\"homeview button#approve\",rejectButton:\"homeview button#reject\",searchButton:\"homeview button#searchProduct",506927,125,",approveButton:{tap:\"onApproveButtonTap\"},rejectButton:{tap:\"onRejectButtonTap\"},searchButton:{tap:\"onSearch",504345,35,507076,60,"b){var f=this,a=f",504622,34,",d=new Date(),e=Ext.getStore(\"History\");d.setHours(0,0,0,0);e.filterBy(function(g){return g.get(\"createdAt\").getTime()>=d.getTime()});var c;if(e.getCount()){c=e.last()}else{c=Ext.create(\"DietonApp.model.History\",{enviromentLevel:3,puppetLevel:3})}b.down(\"container#drawingContainer\").setRecord(c);b.down(\"container#drawingContainer\").setHeight(Ext.Viewport.windowHeight-175",507199,98,"var a=this;if(window.",507300,54,"b){if(!b.cancelled){a.createNewHistory(b)}},function(b",507470,36,"b)})}else{a.createNewHistory(\"5449000051981\")}},onApproveButtonTap:function(){var i=this,b=i.getApplication().getActiveView(),k=b.down(\"container#productInfo\").getData(),c=i",504622,34,";var j=k.quantity.split(\" \")[0];var a=100*k.nutriments.sugars/90;var h=c.get(\"currentSugarLevel\")+(a*c.getKcal()/2000);var f=c.get(\"currentEnviromentLevel\")+(k.ecoFootprint)?k.ecoFootprint:0;if((a*c.getKcal()/2000)<=5){h-=10}var d,e;if(h<=0){d=1}else{if(h<=20){d=2}else{if(h<=60){d=3}else{if(h<=100){d=4}else{d=5}}}}if(((k.ecoFootprint)?k.ecoFootprint:0)<=5){f-=10}if(f<=0){e=1}else{if(f<=20){e=2}else{if(f<=60){e=3}else{if(f<=100){e=4}else{e=5}}}}var g=Ext.create(\"DietonApp.model.History\",{barCode:k.barcode,enviromentLevel:e,puppetLevel:d,latitudeOrigin:k.latitudeOrigin,longitudeOrigin:k.longitudeOrigin,currentLatitude:k.currentLatitude,currentLongitude:k.currentLongitude,currentAccuracy:k.currentAccuracy,productName:k.product_name,productSize:j,productSugar:k.nutriments.sugars,productFat:k.nutriments[\"saturated-fat\"],createdAt:new Date()});g.save();c.set(\"currentSugarLevel\",h);c.set(\"currentEnviromentLevel\",f);c.save();b.down(\"container#drawingContainer\").setRecord(g);b.down(\"button#captureBarcode\").show();b.down(\"button#searchProduct\").show();b.down(\"container#productInfo\").setData(null);b.down(\"container#productInfo\").hide()},onRejectButtonTap:function(){var b=this,a=b.getApplication().getActiveView();a.down(\"button#captureBarcode\").show();a.down(\"button#searchProduct\").show();a.down(\"container#productInfo\").setData(null);a.down(\"container#productInfo\").hide()},onSearchButtonTap:function(){Ext.Msg.alert(\"\",'Pronto podr\ufffff\ufffffs buscar sin utilizar el sistema de escaneo, mientras tanto te animamos a que escanees el c\ufffff\ufffffdigo de barras de cada producto con el bot\ufffff\ufffffn \"Escanear C\ufffff\ufffffdigo\"')},createNewHistory:function(a){var b=this;b.getApplication().loadingMask(true,\"Consultando\");Ext.Ajax.request({url:\"http://world.openfoodfacts.org/api/v0/product/\"+a.text+\".json\",disableCaching:false,method:\"GET\",success:function(d){console.log(a.text+\"*****RES ANDRES**--> \"+d.responseText);var c=JSON.parse(d.responseText);if(c.status===1){c.product.barcode=a.text;var e=function(g){var f=b.getApplication().getActiveView();f.down(\"button#captureBarcode\").hide();f.down(\"button#searchProduct\").hide();f.down(\"container#productInfo\").setData(g);f.down(\"container#productInfo\").show()};navigator.geolocation.getCurrentPosition(function(g){c.product.currentLatitude=g.coords.latitude;c.product.currentLongitude=g.coords.longitude;c.product.currentAccuracy=g.coords.accuracy;var f=new google.maps.Geocoder();f.geocode({address:c.product.countries},function(i,h){if(h===google.maps.GeocoderStatus.OK){var j=i[0].geometry.location;c.product.latitudeOrigin=j.lat();c.product.longitudeOrigin=j.lng();var k=b.getDistanceFromLatLonInKm(c.product.latitudeOrigin,c.product.longitudeOrigin,g.coords.latitude,g.coords.longitude);c.product.ecoFootprint=0.35*k}e(c.product);b.getApplication().loadingMask(false)})},function(f){b.getApplication().loadingMask(false);e(c.product)})}else{b.getApplication().loadingMask(false);Ext.Msg.alert(\"Error\",\"No fue posible realizar la consulta, int\ufffff\ufffffntalo de nuevo.\")}},failure:function(c){b.getApplication().loadingMask(false);Ext.Msg.alert(\"Error\",\"No fue posible realizar la consulta, int\ufffff\ufffffntalo de nuevo.\")},callback:function(d,e,c){console.log(\"Response success: \"+e);console.log(\"responseText: \"+c.responseText);console.log(\"responseStatus: \"+c.status)}})},getDistanceFromLatLonInMeters:function(e,c,d,b){var a=this;return a.getDistanceFromLatLonInKm(e,c,d,b)*1000/1},getDistanceFromLatLonInKm:function(f,i,e,h){var g=6371,k=this.deg2rad(e-f),b=this.deg2rad(h-i),m=Math.sin(k/2)*Math.sin(k/2)+Math.cos(this.deg2rad(f))*Math.cos(this.deg2rad(e))*Math.sin(b/2)*Math.sin(b/2),l=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),j=g*l;return j},deg2rad:function(a){return a*(Math.PI/180)",507511,49,506217,32,"ux.LoadingMask\",Ext.LoadMask,{config:{zIndex:998}},0,[\"loading",300455,37,",\"loading",263915,32,",loadmask:true,loadingmask:true},[\"widget.loadingmask\"],0,[DietonApp.view.ux,\"LoadingMask",507553,141,"views:[\"ux.LoadingMask",507691,590,508345,347,";window.initMaps()},ldMask:null,loading:false,getLdMask:function(){return this.ldMask},setLdMask:function(a){this.ldMask=a},isLoading:function(){return this.loading},setLoading:function(a){this.loading=a},loadingMask:function(a,c){c=c||\"Cargando...\";this.setLoading(a);if(a){if(this.getLdMask()!==null){this.getLdMask().setMessage(c)}else{Ext.Viewport.setMasked({xtype:\"loadingmask\",message:c});this.setLdMask(Ext.Viewport.getMasked())}}else{var d=this.getLdMask();this.setLdMask(null);Ext.Viewport.setMasked(false)}",508692,206]